var board=[];var score=0;var hasConflicted=[];$(function(){newGame();});function newGame(){init();generateOneNumber();generateOneNumber();}function init(){for(var b=0;
b<4;b++){for(var a=0;a<4;a++){var c=$("#grid_cell_"+b+"_"+a);c.css("top",getPosTop(b)).css("left",getPosLeft(a));}}for(var b=0;b<4;b++){board[b]=[];hasConflicted[b]=[];
for(var a=0;a<4;a++){board[b][a]=0;hasConflicted[b][a]=false;}}updateBoardView();score=0;}function updateBoardView(){$(".number_cell").remove();for(var c=0;
c<4;c++){for(var b=0;b<4;b++){$("#grid_container").append('<div class="number_cell" id="number_cell_'+c+"_"+b+'"></div>');var a=$("#number_cell_"+c+"_"+b);
if(board[c][b]===0){a.css("width",0).css("height",0).css("top",getPosTop(c)+50).css("left",getPosLeft(b)+50);}else{a.css("width","100px").css("height","100px").css("top",getPosTop(c)).css("left",getPosLeft(b)).css("background-color",getNumBackgroundColor(board[c][b])).css("color",getNumColor(board[c][b])).text(board[c][b]);
}}}}function generateOneNumber(){if(nospace(board)){return false;}var c,b;do{c=parseInt(Math.floor(Math.random()*4),10);b=parseInt(Math.floor(Math.random()*4),10);
}while(board[c][b]);var a=Math.random()<0.5?2:4;board[c][b]=a;showNumWithAnimation(c,b,a);return true;}$(document).keydown(function(a){switch(a.keyCode){case 37:if(moveLeft()){setTimeout(generateOneNumber,210);
setTimeout(isGameOver,400);}break;case 38:if(moveUp()){setTimeout(generateOneNumber,210);setTimeout(isGameOver,400);}break;case 39:if(moveRight()){setTimeout(generateOneNumber,210);
setTimeout(isGameOver,400);}break;case 40:if(moveDown()){setTimeout(generateOneNumber,210);setTimeout(isGameOver,400);}break;default:break;}});function moveLeft(){if(!canMoveLeft(board)){return false;
}for(var c=0;c<4;c++){for(var b=1;b<4;b++){if(board[c][b]!==0){for(var a=0;a<b;a++){if(board[c][a]===0&&noBlockHorizontal(c,a,b,board)){showMoveAnimotion(c,b,c,a);
board[c][a]=board[c][b];board[c][b]=0;continue;}else{if(board[c][a]===board[c][b]&&noBlockHorizontal(c,a,b,board)){showMoveAnimotion(c,b,c,a);board[c][a]+=board[c][b];
board[c][b]=0;score+=board[c][a];updateScore(score);continue;}}}}}}setTimeout(updateBoardView,200);return true;}function moveUp(){if(!canMoveUp(board)){return false;
}for(var b=0;b<4;b++){for(var c=1;c<4;c++){if(board[c][b]!==0){for(var a=0;a<c;a++){if(board[a][b]===0&&noBlockVertical(b,a,c,board)){showMoveAnimotion(c,b,a,b);
board[a][b]=board[c][b];board[c][b]=0;continue;}else{if(board[a][b]===board[c][b]&&noBlockVertical(b,a,c,board)){showMoveAnimotion(c,b,a,b);board[a][b]+=board[c][b];
board[c][b]=0;score+=board[a][b];updateScore(score);continue;}}}}}}setTimeout(updateBoardView,200);return true;}function moveRight(){if(!canMoveRight(board)){return false;
}for(var c=0;c<4;c++){for(var b=2;b>=0;b--){if(board[c][b]!==0){for(var a=3;a>b;a--){if(board[c][a]===0&&noBlockHorizontal(c,b,a,board)){showMoveAnimotion(c,b,c,a);
board[c][a]=board[c][b];board[c][b]=0;continue;}else{if(board[c][a]===board[c][b]&&noBlockHorizontal(c,b,a,board)){showMoveAnimotion(c,b,c,a);board[c][a]+=board[c][b];
board[c][b]=0;score+=board[c][a];updateScore(score);continue;}}}}}}setTimeout(updateBoardView,200);return true;}function moveDown(){if(!canMoveDown(board)){return false;
}for(var b=0;b<4;b++){for(var c=2;c>=0;c--){if(board[c][b]!==0){for(var a=3;a>c;a--){if(board[a][b]===0&&noBlockVertical(b,c,a,board)){showMoveAnimotion(c,b,a,b);
board[a][b]=board[c][b];board[c][b]=0;continue;}else{if(board[a][b]===board[c][b]&&noBlockVertical(b,c,a,board)){showMoveAnimotion(c,b,a,b);board[a][b]+=board[c][b];
board[c][b]=0;score+=board[a][b];updateScore(score);continue;}}}}}}setTimeout(updateBoardView,200);return true;}function isGameOver(){if(nospace(board)&&nomove(board)){gameOver();
}}function gameOver(){alert("gameover!");}